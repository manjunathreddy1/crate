import { getSP } from "./pnpjsConfig";
import { PermissionKind } from "@pnp/sp/security";
import "@pnp/sp/webs";
import "@pnp/sp/files";

export const checkUserReadPermissionOnPage = async (pageUrl: string): Promise<boolean> => {
  try {
    const sp = getSP();

    // Get the file object of the site page
    const file = sp.web.getFileByServerRelativePath(pageUrl);

    // Check if the current user has Read permission on this file
    const hasPermission = await file
      .select("EffectiveBasePermissions")
      .get()
      .then(f => sp.web.hasPermissions(f.EffectiveBasePermissions, PermissionKind.ViewListItems));

    return hasPermission;
  } catch (error) {
    console.error("Error checking permissions:", error);
    return false;
  }
};
