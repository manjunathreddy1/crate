import { spfi } from "@pnp/sp";
import "@pnp/sp/webs";
import "@pnp/sp/folders";
import "@pnp/sp/files";
import "@pnp/sp/items"; // Needed for ListItemAllFields
import { SPFx } from "@pnp/sp/presets/all"; // For SPFx context

const sp = spfi().using(SPFx(this.context)); // Replace with your actual context

interface IPageTemplate {
  name: string;
  title?: string;
  id?: number;
  [key: string]: any;
}

const getTemplateFilesWithMetadata = async (): Promise<IPageTemplate[]> => {
  try {
    const folder = sp.web.getFolderByServerRelativePath("/sites/yoursite/SitePages/Templates");

    const files = await folder.files.expand("ListItemAllFields")();

    const mapped: IPageTemplate[] = files.map(f => {
      const item = f.ListItemAllFields as any; // You can define a stronger type if needed
      return {
        name: f.Name,
        title: item?.Title,
        id: item?.Id,
        contentTypeId: item?.ContentTypeId
      };
    });

    return mapped;
  } catch (error) {
    console.error("Error fetching template files:", error);
    return [];
  }
};
